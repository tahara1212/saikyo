# テスト駆動開発
TDD Boot Camp 2020 Online #1 基調講演/ライブコーディング (t-wada)

「動作する綺麗なコード」が、テスト駆動開発のゴールである。
一筆書きで「動作する綺麗なコード」を書くのは難しいので、「動作するコード」と「綺麗なコード」に分割する。

## TDDサイクル

### 1.次の目標を考える
何が目的で、何を実装すべきかを書き出す。なるべく機能単位で分解する。
その上で実装の優先順位を設ける。機能の重要性よりも、テスト容易性を重視し、実装が簡単なものから着手する。最初に構築するものはテスト基盤から作成する必要があるが、作業が進むにつれて作成した基盤を応用することができ、実装コストを抑えることができる。よって最初に取り掛かるテストの工数は通常以上に膨らむことから、簡単な処理から着手することが理想とされている。

### 2.その目標を示すテストを書く
実装よりも先にテストを書き、実装の結果がどうなっているべきかを定義する。

### 3.そのテストを実行して失敗させる
実装を行なっていないので、テストは失敗し、テスト失敗時に出力される RED コンソールを確認する。ここでは、テストが失敗するということを計測する目的がある。テストが失敗すらせず、コンソールに何も出現しない場合、テストを行う環境構築につまづいている可能性があることが分かる。

### 4.目的のコードを書く
失敗したテストを成功させるためのコードを書く。ここでは、最短で動作するコードを目指すので、「綺麗なコード」は考慮しない。外部からのコピペや、assertEquals で検証する文字列をそのまま渡すなど、手段を問わない。

### 5.テストを成功させる
テストが成功すると、リファクタリングの段階に入ることができる。テスト駆動開発は「テストが成功している状態のままリファクタリングをし続ける」ということが強力なメリットであり、成功するテストを手にいれることが最優先事項になる。よって最短ルートを走る。成功するテストを手に入れたら、その後のリファクタリングは失敗を計測可能になる。

### 6.テストが通るままでリファクタリングを行う
リファクタリングの定義は、「ソフトウェア外部からの振る舞いを変えないまま、内部の実装を綺麗にしていく」だ。  
テスト駆動開発のリファクタリング定義は、「成功しているテストが成功しているままで、内部の実装を綺麗にしていく」である。
「ソフトウェア外部からの振る舞いを変えないまま」は曖昧な定義であったが、「成功しているテストが成功しているまま」は必ず成功と失敗に判定される。
これによって、安全かつ迅速に、細かい単位でリファクタリングを行う。

### 7.1~6を繰り返す
リファクタリングが完了したら、1で分解した次のタスクに着手する。
分解したタスクが全て実装されたら、全体の機能について改めて考え、そのテストが何のためにあるのかを示す。  
例えば、「引数3を受け取ったら文字列Fizzを返す」というテストは、「3の倍数の時はFizzを、5の倍数の時はBuzzを、3と5の倍数ならFizzBuzzを出力する」という全体の機能の一部であり、この全体像が見えていないユニットテストは目的が分からず、後から改修を加える時に意図を汲み取れなくなる。  
テストは仕様書としての役割も持つので、テストを見ればその処理が何を果たすべきなのかを理解できるようにしておくべきである。よって、ユニットテストの関数名は日本語で記述されることが多い。

## テストケース
テストケースの数は多ければ良いというわけでない。